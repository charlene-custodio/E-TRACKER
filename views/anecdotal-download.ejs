<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>E'SCHOLARS Anecdotal Report</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { background: #f7fafc; }
    .main-container { margin: auto; background: white; font-size: 0.85rem; }
    .report-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; padding-top: 10px; }
    .header-center { flex: 1; text-align: center; }
    .header-title { font-size:1.1rem; font-weight: bold; line-height:1.1; }
    .header-subtitle { font-size:0.8rem; margin-top:2px; }
    .header-report { font-size:0.9rem; font-weight: bold; margin-top:2px; }
    .logos { width:42px; height:42px; object-fit:contain; }
    .report-table { border-collapse: collapse; width: 100%; table-layout: fixed; font-family: 'Times New Roman', Times, serif, sans-serif; margin-top:16px; font-size: 0.60rem; }
    .report-table th, .report-table td { border: 1px solid #000; vertical-align: top; font-size: 0.60rem; word-break: break-word; padding: 4px 2px; background: #fff; }
    .report-table th { font-weight: bold; text-align: center; background:transparent; }
    .signature-section { margin-top:80px; width:100%; }
    .signature-row { display: flex; justify-content:space-between; width:100%; margin-bottom:40px; }
    .signature-col { width:24%; text-align:center; }
    .signature-line { border-top: 1px solid #000; width:60%; margin:auto; margin-bottom:4px; }
    .signature-label { font-size:0.70rem; font-weight:400; }
    .signature-sub { font-size:0.65rem; font-style:italic; color:#555; }
    @media print {
      .print-hide { display:none!important; }
      .main-container { box-shadow:none; }
      body { background: #fff; }
      .main-container { max-width: 100%; }
    }
    .loading-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.5); display: flex;
      flex-direction: column; justify-content: center; align-items: center; z-index: 9999;
    }
    .loading-spinner {
      border: 5px solid #f3f3f3; border-top: 5px solid #3498db;
      border-radius: 50%; width: 40px; height: 40px;
      animation: spin 2s linear infinite; margin-bottom: 10px;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="main-container p-2" id="report-main">
    <!-- Header -->
    <div class="report-header">
      <img src="/images/left-logo.png" alt="Left Logo" class="logos" />
      <div class="text-center">
        <div class="header-title">E'SCHOLARS</div>
        <div class="header-subtitle font-semibold">
          (Engagement of City Scholars to Community in Honing Ormocanon Learners Achieve Reading, Writing, and Arithmetic Skills)
        </div>
        <div class="header-report">ANECDOTAL REPORT</div>
      </div>
      <img src="/images/right-logo.png" alt="Right Logo" class="logos" />
    </div>
    <!-- Table -->
    <table id="intervention-table" class="report-table">
      <thead>
        <tr>
          <th rowspan="2" style="width:7.5%;">Date<br><span style="font-size:0.80em;">(MM/DD/YYYY)</span></th>
          <th colspan="2" style="width:10.5%;">Time</th>
          <th rowspan="2" style="width:5.5%;">No. of<br>Hours</th>
          <th rowspan="2" style="width:15.5%;">Name of learner</th>
          <th rowspan="2" style="width:13.5%;">School</th>
          <th rowspan="2" style="width:5.5%;">Grade<br>level</th>
          <th rowspan="2" style="width:16.5%;">Learner’s Difficulties/Behaviors<br><span style="font-size:0.9em;">(Reading, Numeracy, Writing)</span></th>
          <th rowspan="2" style="width:12.5%;">Scholar’s Intervention(s)</th>
          <th rowspan="2" style="width:12.5%;">Result (Significant Findings)</th>
        </tr>
        <tr>
          <th style="width:5.25%;">Started</th>
          <th style="width:5.25%;">Ended</th>
        </tr>
      </thead>
      <tbody>
        <% if (reports && reports.length > 0) { %>
            <% reports.forEach(function(report) { %>
            <tr>
                <td><%= new Date(report.report_date).toLocaleDateString('en-US') %></td>
                <td>
                <% if (report.sessions && report.sessions.length > 0) { %>
                    <% report.sessions.forEach(function(s, idx) { %>
                    <span>
                        <%= formatTime12(s.time_in) %>
                    </span><%= idx < report.sessions.length-1 ? ", " : "" %>
                    <% }); %>
                <% } %>
                </td>
                <td>
                <% if (report.sessions && report.sessions.length > 0) { %>
                    <% report.sessions.forEach(function(s, idx) { %>
                    <span>
                        <%= formatTime12(s.time_out) %>
                    </span><%= idx < report.sessions.length-1 ? ", " : "" %>
                    <% }); %>
                <% } %>
                </td>
                <td><%= report.hours %></td>
                <td><%= report.student_name %></td>
                <td><%= report.school_name %></td>
                <td><%= report.grade_level %></td>
                <td><%= report.learner_difficulties %></td>
                <td><%= report.intervention %></td>
                <td><%= report.result %></td>
            </tr>
            <% }); %>
        <% } %>
        </tbody>
    </table>
    <!-- Signature Section -->
    <div class="signature-section font-xs">
      <div class="signature-row">
        <div class="signature-col"><div class="signature-line"></div><div class="signature-label">Name of Scholar</div><div class="signature-sub">Signature over Printed Name</div></div>
        <div class="signature-col"></div>
        <div class="signature-col"></div>
        <div class="signature-col"><div class="signature-line"></div><div class="signature-label">Parent/Guardian</div><div class="signature-sub">Signature over Printed Name</div></div>
      </div>
      <div class="signature-row">
        <div class="signature-col"><div class="signature-line"></div><div class="signature-label">Name of Teacher Adviser/Date Submitted</div><div class="signature-sub">Signature over Printed Name and Date</div></div>
        <div class="signature-col"></div>
        <div class="signature-col"></div>
        <div class="signature-col"><div class="signature-line"></div><div class="signature-label">Name of School Administrator/Date Submitted</div><div class="signature-sub">Signature over Printed Name and Date</div></div>
      </div>
    </div>
  </div>
  <div class="text-center my-3 print-hide">
    <button onclick="window.print()" class="px-4 py-1 mx-2 bg-gray-100 border border-gray-300 rounded hover:bg-gray-200 text-sm">Print Report</button>
    <!-- <button id="download-pdf" class="px-4 py-1 mx-2 bg-green-100 border border-green-300 rounded hover:bg-green-200 text-sm">Download PDF</button> -->
  </div>
  <script>
    // document.getElementById('download-pdf').addEventListener('click', () => {
    //   const overlay = document.createElement('div');
    //   overlay.className = 'loading-overlay';
    //   overlay.innerHTML = '<div class="loading-spinner"></div><div class="text-white text-xl">Generating PDF...</div>';
    //   document.body.appendChild(overlay);

    //   setTimeout(() => {
    //     const clone = document.querySelector('.main-container').cloneNode(true);
    //     clone.querySelectorAll('.print-hide').forEach(el => el.remove());

    //     clone.style.position = 'absolute';
    //     clone.style.left = '-9999px';
    //     document.body.appendChild(clone);

    //     html2canvas(clone, { scale: 2, useCORS: true }).then(canvas => {
    //       const { jsPDF } = window.jspdf;
    //       const pdf = new jsPDF({ orientation: 'landscape', unit: 'pt', format: [1920, 1080] });
    //       const imgData = canvas.toDataURL('image/jpeg', 1.0);
    //       pdf.addImage(imgData, 'JPEG', 0, 0, 1920, 1080);
    //       pdf.save('e_scholars_report.pdf');
    //       document.body.removeChild(clone);
    //       document.body.removeChild(overlay);
    //     }).catch(() => {
    //       alert('PDF generation failed.');
    //       document.body.removeChild(clone);
    //       document.body.removeChild(overlay);
    //     });
    //   }, 100);
    // });
  </script>
</body>
</html>